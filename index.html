<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🌸 訂單管理系統</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<header class="header">
  🌸 訂單・撥款・簡訊 一次搞定
</header>

<nav class="tabs">
  <button class="tab active" data-target="add">📥 新增訂單</button>
  <button class="tab" data-target="list">📋 訂單列表</button>
  <button class="tab" data-target="sms">💬 SMS 通知</button>
</nav>

<main>
  <section id="add" class="panel active">
    <div class="layout single-column">
      <div class="card full-width" style="max-width: 600px;">
        <h2>🧾 新增訂單</h2>
        <div id="step1">
          <label class="label">訂單資訊</label>
          <input id="orderNo" placeholder="訂單編號" />
          <input id="name" placeholder="客戶姓名 (必填)" />
          <input id="phone" placeholder="手機號碼" type="tel" />
          
          <label class="label">購物平台</label>
          <select id="platform">
            <option value="賣貨便">賣貨便 (7-11)</option>
            <option value="好賣+">好賣+ (全家)</option>
          </select>
          
          <button class="btn primary" id="nextStepBtn" style="width:100%; margin-top:10px;">下一步 ➜</button>
        </div>

        <div id="step2" class="hidden">
          <label class="label">取貨資訊</label>
          <input id="store" placeholder="取貨門市" />
          <label class="label">取貨期限 <input type="date" id="pickupDeadline" /></label>
          <div class="actions">
            <button class="btn" id="prevStepBtn">← 上一步</button>
            <button class="btn primary" id="addOrderBtn">✨ 完成新增</button>
          </div>
        </div>
      </div>
      
      <div class="card full-width" style="max-width: 600px; margin-top: 20px;">
        <h3>📂 剛剛新增的訂單</h3>
        <div id="recentOrders" class="list"></div>
      </div>
    </div>
  </section>

  <section id="list" class="panel">
    <div class="layout single-column">
      <div class="card full-width">
        <h2>📋 訂單列表</h2>

        <details style="margin-bottom:15px;">
          <summary>➕ 從 Excel 批量複製貼上</summary>
          <div style="background:#fff; padding:15px; border:2px solid #eee;">
            <p style="font-size:13px; color:#666; margin:0 0 5px 0;">請直接從 Excel 複製 (Ctrl+C) 並貼上 (Ctrl+V) 到下方：</p>
            <textarea id="bulkInput" placeholder="Excel 欄位順序：編號 | 姓名 | 手機 | 平台 | 門市"></textarea>
            <button class="btn small primary" id="bulkImportBtn">確認匯入</button>
          </div>
        </details>

        <div class="list-toolbar">
          <button class="btn small" id="selectAllBtn">全選</button>
          <button class="btn small" id="clearSelectionBtn">清除</button>
          <button class="btn small danger" id="deleteSelectedBtn">🗑️ 刪除選取</button>
        </div>

        <div id="orderList" class="list"></div>
      </div>
    </div>
  </section>

  <section id="sms" class="panel">
    <div class="layout">
      <div class="card">
        <h2>✅ 準備發送名單</h2>
        <div id="selectedOrders" class="list"></div>
      </div>
      <div class="card">
        <h2>💬 編輯簡訊</h2>
        <textarea id="smsContent" style="height:120px;">您好，您的包裹已抵達門市，請儘速取貨，謝謝！🌸</textarea>
        <button class="btn primary" id="sendSmsBtn">🚀 發送簡訊</button>
      </div>
    </div>
  </section>
</main>

<script src="utils.js"></script>
<script src="rules.js"></script>
<script src="orders.js"></script> <script src="sms.js"></script>

<script>
  // 分頁切換
  document.querySelectorAll('.tab').forEach(btn => {
    btn.addEventListener('click', e => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      e.currentTarget.classList.add('active');
      document.getElementById(e.currentTarget.dataset.target).classList.add('active');
    });
  });

  // 新增訂單步驟
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  document.getElementById('nextStepBtn').onclick = () => {
    if(!document.getElementById('name').value) { alert('姓名必填！'); return; }
    step1.classList.add('hidden'); step2.classList.remove('hidden');
  };
  document.getElementById('prevStepBtn').onclick = () => {
    step2.classList.add('hidden'); step1.classList.remove('hidden');
  };
  
  // 綁定新增按鈕 (呼叫 orders.js)
  document.getElementById('addOrderBtn').onclick = () => {
     if(typeof addOrderFromForm === 'function') {
         addOrderFromForm();
         step2.classList.add('hidden'); step1.classList.remove('hidden');
     } else {
         alert('錯誤：orders.js 尚未更新，找不到 addOrderFromForm 函式');
     }
  };
</script>
</body>
</html>
